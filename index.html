<!DOCTYPE html>

<body>

    <div id="demo">
        <h1>The ESP8266 NodeMCU Update web page without refresh</h1>
        <button type="button" onclick="sendData(1)">LED ON</button>
        <button type="button" onclick="sendData(0)">LED OFF</button><BR>
    </div>
    <div id="colorPicker">
        <input type="color" id="colorinput">
        <button onclick="sendColor()">Submit</button>
        Value received by server: <span id="colorValue">-</span>
    </div>

    <div>
        ADC Value is : <span id="ADCValue">0</span><br>
        LED State is : <span id="LEDState">NA</span>
    </div>
    <script>
        function sendData(led) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("LEDState").innerHTML =
                        this.responseText;
                    console.log(this.statusText + " with response: " + this.responseText);
                }
            };
            xhttp.open("GET", "setLED?LEDstate=" + led, true);
            xhttp.send();
        }

        setInterval(function () {
            // Call a function repetatively with 2 Second interval
            getData();
        }, 2000); //2000mSeconds update rate

        function getData() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("ADCValue").innerHTML =
                        this.responseText;
                }
            };
            xhttp.open("GET", "readADC", true);
            xhttp.send();
        }
        
        const hex2rgb = (hex) => {
            const r = parseInt(hex.slice(1, 3), 16)
            const g = parseInt(hex.slice(3, 5), 16)
            const b = parseInt(hex.slice(5, 7), 16)
            // return {r, g, b} // return an object
            return [ r, g, b ]
        }

        function sendColor() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("colorValue").innerHTML =
                        this.responseText;
                }
            };
            let colorValue = hex2rgb(document.getElementById("colorinput").value);
            xhttp.open("GET", "changeColor?color=" + colorValue, true);
            xhttp.send();
        }
    </script>
</body>

</html>